[{"id":"1aa13a11.c9d0c6","type":"tab","label":"Siri Control"},{"id":"8f718bac.fa7838","type":"tcp in","z":"1aa13a11.c9d0c6","name":"","server":"server","host":"","port":"4056","datamode":"single","datatype":"buffer","newline":"","topic":"","base64":false,"x":130,"y":121.00000953674316,"wires":[["111a7c3f.a81804","b7028e17.134fa"]]},{"id":"1358c51f.a66e0b","type":"inject","z":"1aa13a11.c9d0c6","name":"Hello Siri","topic":"","payload":"Hello Siri","payloadType":"str","repeat":"","crontab":"","once":false,"x":134.58334732055664,"y":260.50006103515625,"wires":[["fe015b1a.923b08"]]},{"id":"fe015b1a.923b08","type":"tcp out","z":"1aa13a11.c9d0c6","host":"127.0.0.1","port":"4056","beserver":"client","base64":false,"end":true,"name":"","x":351.0833320617676,"y":264.5833435058594,"wires":[]},{"id":"f8af2782.1bb0e8","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":true,"console":"false","complete":"false","x":525.0833969116211,"y":117.91666221618652,"wires":[]},{"id":"111a7c3f.a81804","type":"function","z":"1aa13a11.c9d0c6","name":"","func":"msg.payload = msg.payload.toString();\nreturn msg;","outputs":1,"noerr":0,"x":337.58335876464844,"y":120.00002765655518,"wires":[["f8af2782.1bb0e8","b8eddced.d81b7","e1c55859.dcc998","3f784008.7c218","6e6c06cf.02aad8","9abfdfdb.55692"]]},{"id":"6e6c06cf.02aad8","type":"function","z":"1aa13a11.c9d0c6","name":"Relay Words Spoken","func":"var msg = msg.payload;\nvar relayone = '0';\nvar relaytwo = '0';\nvar relaythree = '0';\nif (msg == \"relay one on\")\n    {\n    relayone = '1';\n    }\nif (msg == \"relay one off\")\n    {\n    relayone = '0';\n    }\nif (msg == \"relay two on\")\n    {\n    relaytwo = '1';\n    }\nif (msg == \"relay two off\")\n    {\n    relaytwo = '0';\n    }    \nif (msg == \"relay three on\")\n    {\n    relaythree = '1';\n    }\nif (msg == \"relay three off\")\n    {\n    relaythree = '0';\n    }   \nreturn [relayone,relaytwo,relaythree];\n","outputs":"3","noerr":0,"x":710.6249885559082,"y":233.25,"wires":[["cb080c75.611bd"],["cb080c75.611bd"],["666bbaca.63f034"]]},{"id":"b9ad3b43.b182b8","type":"rpi-gpio out","z":"1aa13a11.c9d0c6","name":"Relay 1 - Pin 11 GPIO 17","pin":"11","set":true,"level":"1","out":"out","x":1447.37504196167,"y":369.2500114440918,"wires":[]},{"id":"d0294103.f2a8a","type":"rpi-gpio out","z":"1aa13a11.c9d0c6","name":"Relay 2 - Pin 13 GPIO 27","pin":"13","set":true,"level":"1","out":"out","x":1439.12504196167,"y":438.75001525878906,"wires":[]},{"id":"e678608.4d664a","type":"rpi-gpio out","z":"1aa13a11.c9d0c6","name":"Relay 3 - Pin 15 GPIO 22","pin":"15","set":true,"level":"1","out":"out","x":1447.6250343322754,"y":495.50000858306885,"wires":[]},{"id":"3f784008.7c218","type":"function","z":"1aa13a11.c9d0c6","name":"Other Words Spoken","func":"newMsg = msg.payload;\nvar str = newMsg;\nvar foxtel_spoken = str.search(\"foxtel\");\nvar dvd_spoken = str.search(\"dvd\");\nvar media_player_spoken = str.search(\"media player\");\nvar cd_spoken = str.search(\"cd\");\nvar media_source = \"\";\n\n//test if input selections spoken\nif (foxtel_spoken < 0)\n    {\n    media_source = \"Foxtel\";\n    }\nif (dvd_spoken < 0)\n    {\n    media_source = \"DVD\";\n    }\nif (media_player_spoken < 0)\n    {\n    media_source = \"Media Player\";\n    }\nif (cd_spoken < 0)\n    {\n    media_source = \"CD\";\n    }\n\nreturn media_source;","outputs":"1","noerr":0,"x":711.6249885559082,"y":169.25,"wires":[["4c16b5a.9a63a4c"]]},{"id":"b8eddced.d81b7","type":"function","z":"1aa13a11.c9d0c6","name":"Test if Computer Spoken","func":"msg.payload = msg.payload.toString();\nnewMsg = msg.payload;\nvar str = newMsg;\n\nvar computer_spoken = str.search(\"computer\");\n\n//test if computer spoken\nif (computer_spoken < 0)\n    {\n     node.send ({payload:[str]});\n    //return str; \n    }\nreturn null;","outputs":"1","noerr":0,"x":742.3750152587891,"y":41.75000476837158,"wires":[["2e394af8.84d8f6"]]},{"id":"17c568d3.2aafb7","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 1 on","topic":"","payload":"relay one on","payloadType":"str","repeat":"","crontab":"","once":false,"x":171.58334732055664,"y":377.25,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"22549d96.32b412","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 1 off","topic":"","payload":"relay one off","payloadType":"str","repeat":"","crontab":"","once":false,"x":172.58334732055664,"y":418.25,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"41190b89.1cd8a4","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 2 on","topic":"","payload":"relay two on","payloadType":"str","repeat":"","crontab":"","once":false,"x":173.58334732055664,"y":461.25,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"3eaa2bbc.822c34","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 2 off","topic":"","payload":"relay two off","payloadType":"str","repeat":"","crontab":"","once":false,"x":174.58334732055664,"y":500.25,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"fa41cd12.1cf64","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 3 on","topic":"","payload":"relay three on","payloadType":"str","repeat":"","crontab":"","once":false,"x":172.8333511352539,"y":541.0000162124634,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"fca26e7d.e4f6","type":"inject","z":"1aa13a11.c9d0c6","name":"Relay 3 off","topic":"","payload":"relay three off","payloadType":"str","repeat":"","crontab":"","once":false,"x":170.5833511352539,"y":580.2500085830688,"wires":[["e1c55859.dcc998","328fb5bf.5cc37a"]]},{"id":"efa78ea6.c2292","type":"switch","z":"1aa13a11.c9d0c6","name":"Relay One Switch","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"relay 1 on","vt":"str"},{"t":"eq","v":"relay 1 off","vt":"str"},{"t":"eq","v":"relay 2 on","vt":"str"},{"t":"eq","v":"relay 2 off","vt":"str"},{"t":"eq","v":"relay 3 on","vt":"str"},{"t":"eq","v":"relay 3 off","vt":"str"},{"t":"eq","v":"garage door open","vt":"str"},{"t":"eq","v":"garage door close","vt":"str"}],"checkall":"true","outputs":8,"x":743.7500228881836,"y":418.7500114440918,"wires":[["d992e019.506ad","4e10e574.3b698c"],["d992e019.506ad","4e10e574.3b698c"],["73eac2fa.0f7a5c","4e10e574.3b698c"],["73eac2fa.0f7a5c","4e10e574.3b698c"],["838b0a88.ddfc48","4e10e574.3b698c"],["838b0a88.ddfc48","4e10e574.3b698c"],["d992e019.506ad"],["d992e019.506ad"]]},{"id":"e1c55859.dcc998","type":"function","z":"1aa13a11.c9d0c6","name":"Split Data","func":"// seperate string in arrays and find how many elements in array\nvar msgdata = msg.payload.split(\" \");\nvar datalength = msgdata.length;\n\nfor (i = 0; i < msgdata.length; i++) // llok for word relay\n    { \n    if (msgdata[i] == \"relay\")\n        {\n        var relay_index = i;\n        //node.send ({payload:[msgdata[relay_index]]});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word one\n    { \n    if (msgdata[i] == \"one\")\n        {\n        var one_index = i;\n        var relay_number = 1;\n        //node.send ({payload:[msgdata[one_index]]});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word two\n    { \n    if (msgdata[i] == \"two\")\n        {\n        var two_index = i;\n        var relay_number = 2;\n        //node.send ({payload:[msgdata[two_index]]});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word three\n    { \n    if (msgdata[i] == \"three\")\n        {\n        var three_index = i;\n        var relay_number = 3;\n        //node.send ({payload:[msgdata[three_index]]});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word on\n    { \n    if (msgdata[i] == \"on\")\n        {\n        var on_index = i;\n        var relay_mode = 'on';\n        //var d_msg = (\"relay \" + relay_number + \" on\");\n        //return [\"relay \" + relay_number + \" on\"];\n        //node.send ({payload:[msgdata[on_index]]});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word off\n    { \n    if (msgdata[i] == \"off\")\n        {\n        var off_index = i;\n        var relay_mode = 'off';\n        //var d_msg = (\"relay \" + relay_number + \" off\");\n        //return [\"relay \" + relay_number + \" off\"];\n        //node.send ({payload:[msgdata[off_index]]});\n        }\n    }\n\n//send to output on off signals to the three ports    \nif (relay_number == 1)\n    {\n    //var d_msg = (\"relay \" + relay_number + \" off\");\n    //return [\"relay \" + relay_number + \" off\"];\n    node.send ({payload:[\"relay 1 \" + relay_mode]});\n    \n    //node.send ({payload:[\"relay \" + relay_number + \" on/off\"]});\n    //return ['out 1',null,null];\n    }\nif (relay_number == 2)\n    {\n    node.send ({payload:[\"relay 2 \" + relay_mode]});        \n    //node.send ({payload:[null,\"relay 2 \" + relay_mode,null]});        \n    \n    //return [null,'out 2',null];\n    }\nif (relay_number == 3)\n    {\n    node.send ({payload:[\"relay 3 \" + relay_mode]});    \n    //node.send ({payload:[null,null,\"relay 3 \" + relay_mode]});    \n    //node.send ({payload:[\"relay \" + relay_number + \" on/off\"]});\n    //return [null,null,'out 3'];\n    }\n\n//node.send ({payload:[datalength]});\n\nreturn [null];\n\n\n\n\n//working code\n//var msgdata = msg.payload.split(\" \");\n//var datalength = msgdata.length;\n//node.send ({payload:[msgdata[0]]});\n//node.send ({payload:[msgdata[1]]});\n//node.send ({payload:[msgdata[2]]});\n//node.send ({payload:[datalength]});\n//return [null];\n","outputs":"1","noerr":0,"x":550.0000190734863,"y":421.2500123977661,"wires":[["efa78ea6.c2292","328fb5bf.5cc37a"]]},{"id":"4c16b5a.9a63a4c","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":false,"console":"false","complete":"false","x":997.7083587646484,"y":141.1111068725586,"wires":[]},{"id":"cb080c75.611bd","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":false,"console":"false","complete":"false","x":1187.7082595825195,"y":188.6111183166504,"wires":[]},{"id":"666bbaca.63f034","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":false,"console":"false","complete":"false","x":1175.2082595825195,"y":238.61112022399902,"wires":[]},{"id":"d992e019.506ad","type":"function","z":"1aa13a11.c9d0c6","name":"Relay 1 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 1 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nif (msg == \"relay 1 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"garage door open\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nif (msg == \"garage door close\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }    \nreturn [null];  ","outputs":1,"noerr":0,"x":1168.9582595825195,"y":577.5000169277191,"wires":[["b9ad3b43.b182b8"]]},{"id":"73eac2fa.0f7a5c","type":"function","z":"1aa13a11.c9d0c6","name":"Relay 2 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 2 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"relay 2 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nreturn [null];  ","outputs":1,"noerr":0,"x":1175,"y":645,"wires":[["d0294103.f2a8a"]]},{"id":"838b0a88.ddfc48","type":"function","z":"1aa13a11.c9d0c6","name":"Relay 3 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 3 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"relay 3 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nreturn [null];  ","outputs":1,"noerr":0,"x":1176.25,"y":705,"wires":[["e678608.4d664a"]]},{"id":"4e10e574.3b698c","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":false,"console":"false","complete":"false","x":1058.9582633972168,"y":296.11119079589844,"wires":[]},{"id":"328fb5bf.5cc37a","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":true,"console":"false","complete":"false","x":673.9583587646484,"y":556.1111068725586,"wires":[]},{"id":"b7028e17.134fa","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":false,"console":"false","complete":"false","x":422.7083206176758,"y":48.61111640930176,"wires":[]},{"id":"2e394af8.84d8f6","type":"debug","z":"1aa13a11.c9d0c6","name":"","active":true,"console":"false","complete":"false","x":962.7083587646484,"y":46.11111640930176,"wires":[]},{"id":"9abfdfdb.55692","type":"function","z":"1aa13a11.c9d0c6","name":"Split Data - Garage Door","func":"// seperate string in arrays and find how many elements in array\nvar msgdata = msg.payload.split(\" \");\nvar datalength = msgdata.length;\n\nfor (i = 0; i < msgdata.length; i++) // look for the word one\n    { \n    if (msgdata[i] == \"garage\")\n        {\n        var one_index = i;\n        var relay_number = 1;\n        }\n    }\n\nfor (i = 0; i < msgdata.length; i++) // look for the word open\n    { \n    if (msgdata[i] == \"open\")\n        {\n        var on_index = i;\n        var relay_mode = 'open';\n        }\n    }\n\nfor (i = 0; i < msgdata.length; i++) // look for the word close\n    { \n    if (msgdata[i] == \"close\")\n        {\n        var off_index = i;\n        var relay_mode = 'close';\n        }\n    }\n\n//send to output on off signals to the relay    \nif (relay_number == 1)\n    {\n    node.send ({payload:[\"garage door \" + relay_mode]});\n    }\nreturn [null];","outputs":"1","noerr":0,"x":625,"y":306,"wires":[["efa78ea6.c2292"]]}]