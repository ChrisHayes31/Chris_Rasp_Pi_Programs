[{"id":"8bfab7e0.6e1cd8","type":"rpi-gpio out","z":"c3b404ac.8f75d8","name":"Relay 3 - Pin 15 GPIO 22","pin":"15","set":true,"level":"1","out":"out","x":1430,"y":280,"wires":[]},{"id":"b1a4b275.daa0f","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 2 off","topic":"","payload":"relay two off","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":300,"wires":[["b352acbb.32925","4c74772d.4608c8"]]},{"id":"4ea04b64.49e9c4","type":"switch","z":"c3b404ac.8f75d8","name":"Relay Switching Controls","property":"payload","propertyType":"msg","rules":[{"v":"relay 1 on","vt":"str","t":"eq"},{"v":"relay 1 off","vt":"str","t":"eq"},{"v":"relay 2 on","vt":"str","t":"eq"},{"v":"relay 2 off","vt":"str","t":"eq"},{"v":"relay 3 on","vt":"str","t":"eq"},{"v":"relay 3 off","vt":"str","t":"eq"},{"v":"garage door open","vt":"str","t":"eq"},{"v":"garage door close","vt":"str","t":"eq"}],"checkall":"true","outputs":8,"x":910,"y":120,"wires":[["56700ddc.c179c4","81f9b514.ee09c8"],["56700ddc.c179c4","81f9b514.ee09c8"],["7dc8842b.d0f32c","81f9b514.ee09c8"],["7dc8842b.d0f32c","81f9b514.ee09c8"],["9ab072e5.a628d","81f9b514.ee09c8"],["9ab072e5.a628d","81f9b514.ee09c8"],["56700ddc.c179c4"],["56700ddc.c179c4"]]},{"id":"fe7adbf4.e25f28","type":"debug","z":"c3b404ac.8f75d8","name":"","active":false,"console":"false","complete":"false","x":1187.777847290039,"y":395.5555238723755,"wires":[]},{"id":"96c1a9b0.991388","type":"play audio","z":"c3b404ac.8f75d8","name":"Play Relay Sound","voice":"4","x":1210,"y":340,"wires":[]},{"id":"b21733fb.8b0fe","type":"debug","z":"c3b404ac.8f75d8","name":"","active":false,"console":"false","complete":"false","x":490,"y":60,"wires":[]},{"id":"81f9b514.ee09c8","type":"debug","z":"c3b404ac.8f75d8","name":"","active":false,"console":"false","complete":"false","x":1235.624900817871,"y":72.77789115905762,"wires":[]},{"id":"56700ddc.c179c4","type":"function","z":"c3b404ac.8f75d8","name":"Relay 1 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 1 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nif (msg == \"relay 1 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"garage door open\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nif (msg == \"garage door close\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }    \nreturn [null];  ","outputs":1,"noerr":0,"x":1200,"y":160,"wires":[["8c86f588.4d6488"]]},{"id":"fa9978de.3e4978","type":"link in","z":"c3b404ac.8f75d8","name":"Relay Data From Siri","links":["3a083f00.0e1a52","f5b0f59a.32a7f8"],"x":335,"y":60,"wires":[["b21733fb.8b0fe","b352acbb.32925"]]},{"id":"bfec5bbc.bca448","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 3 off","topic":"","payload":"relay three off","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":380,"wires":[["b352acbb.32925","4c74772d.4608c8"]]},{"id":"e12c323b.414d4","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 1 off","topic":"","payload":"relay one off","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":220,"wires":[["b352acbb.32925","4c74772d.4608c8"]]},{"id":"818dedfe.bffce","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 1 on","topic":"","payload":"relay one on","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":180,"wires":[["b352acbb.32925","4c74772d.4608c8"]]},{"id":"9ab072e5.a628d","type":"function","z":"c3b404ac.8f75d8","name":"Relay 3 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 3 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"relay 3 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nreturn [null];  ","outputs":1,"noerr":0,"x":1200,"y":280,"wires":[["8bfab7e0.6e1cd8"]]},{"id":"7dc8842b.d0f32c","type":"function","z":"c3b404ac.8f75d8","name":"Relay 2 Control","func":"msg = msg.payload;\nvar relay_mode;\nif (msg == \"relay 2 off\")\n    {\n    relay_mode = 1;\n    node.send ({payload:[\"1\"]});\n    }\nif (msg == \"relay 2 on\")\n    {\n    relay_mode = 0;\n    node.send ({payload:[\"0\"]});\n    }\nreturn [null];  ","outputs":1,"noerr":0,"x":1200,"y":220,"wires":[["6497046.49ccefc"]]},{"id":"51501423.37cc6c","type":"function","z":"c3b404ac.8f75d8","name":"","func":"msg.payload = msg.payload.toString();\n//if (msg == \"DOOR BELL PRESSED\")\n//    {\n//    var newMsg = 1;\n//    node.send ({payload:[newMsg.payload]});\n//    }\n\nif (msg == \"relay 1 on\")\n    {\n    msg = \"Relay One On\";\n    }\nif (msg == \"relay 1 off\")\n    {\n    msg = \"Relay One Off\";\n    }\nif (msg == \"relay 2 on\")\n    {\n    msg = \"Relay Two On\";\n    }\nif (msg == \"relay 2 off\")\n    {\n    msg = \"Relay Two Off\";\n    }\nif (msg == \"relay 3 on\")\n    {\n    msg = \"Relay Three On\";\n    }\nif (msg == \"relay 3 off\")\n    {\n    msg = \"Relay Three Off\";\n    }\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":340,"wires":[["96c1a9b0.991388","fe7adbf4.e25f28"]]},{"id":"b352acbb.32925","type":"function","z":"c3b404ac.8f75d8","name":"Split Data - Relay Controls","func":"// seperate string in arrays and find how many elements in array\nvar msgdata = msg.payload.split(\" \");\nvar datalength = msgdata.length;\n\nfor (i = 0; i < msgdata.length; i++) // llok for word relay\n    { \n    if (msgdata[i] == \"relay\")\n        {\n        var relay_index = i;\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word one\n    { \n    if (msgdata[i] == \"one\")\n        {\n        var one_index = i;\n        var relay_number = 1;\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word two\n    { \n    if (msgdata[i] == \"two\")\n        {\n        var two_index = i;\n        var relay_number = 2;\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word three\n    { \n    if (msgdata[i] == \"three\")\n        {\n        var three_index = i;\n        var relay_number = 3;\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word on\n    { \n    if (msgdata[i] == \"on\")\n        {\n        var on_index = i;\n        var relay_mode = 'on';\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word off\n    { \n    if (msgdata[i] == \"off\")\n        {\n        var off_index = i;\n        var relay_mode = 'off';\n        }\n    }\n\n//send to output on off signals to the three ports    \nif (relay_number == 1)\n    {\n    node.send ({payload:[\"relay 1 \" + relay_mode]});\n    }\nif (relay_number == 2)\n    {\n    node.send ({payload:[\"relay 2 \" + relay_mode]});        \n    }\nif (relay_number == 3)\n    {\n    node.send ({payload:[\"relay 3 \" + relay_mode]});    \n    }\nreturn [null];\n\n\n//working code\n//var msgdata = msg.payload.split(\" \");\n//var datalength = msgdata.length;\n//node.send ({payload:[msgdata[0]]});\n//node.send ({payload:[msgdata[1]]});\n//node.send ({payload:[msgdata[2]]});\n//node.send ({payload:[datalength]});\n//return [null];\n","outputs":"1","noerr":0,"x":629.0000762939453,"y":119.50003242492676,"wires":[["4ea04b64.49e9c4","4c74772d.4608c8","51501423.37cc6c"]]},{"id":"6497046.49ccefc","type":"rpi-gpio out","z":"c3b404ac.8f75d8","name":"Relay 2 - Pin 13 GPIO 27","pin":"13","set":true,"level":"1","out":"out","x":1430,"y":220,"wires":[]},{"id":"8c86f588.4d6488","type":"rpi-gpio out","z":"c3b404ac.8f75d8","name":"Relay 1 - Pin 11 GPIO 17","pin":"11","set":true,"level":"1","out":"out","x":1430,"y":160,"wires":[]},{"id":"3baae8d2.f5f5f8","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 2 on","topic":"","payload":"relay two on","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":260,"wires":[["b352acbb.32925","4c74772d.4608c8"]]},{"id":"4c74772d.4608c8","type":"debug","z":"c3b404ac.8f75d8","name":"","active":false,"console":"false","complete":"false","x":890,"y":400,"wires":[]},{"id":"434299bd.2c93d8","type":"inject","z":"c3b404ac.8f75d8","name":"Relay 3 on","topic":"","payload":"relay three on","payloadType":"str","repeat":"","crontab":"","once":false,"x":340,"y":340,"wires":[["b352acbb.32925","4c74772d.4608c8"]]}]