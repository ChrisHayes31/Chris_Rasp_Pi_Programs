[{"id":"d9809a91.ecae98","type":"play audio","z":"ba7c0abf.cd20f8","name":"Play Relay Sound","voice":"0","x":970,"y":140,"wires":[]},{"id":"ec902402.46e358","type":"link in","z":"ba7c0abf.cd20f8","name":"To Voice","links":["c3ea6055.a4a56","424c69be.605328","fbedc0dc.e783d","5a91790e.6c4ab8","edfc6f05.12dee","86568e1b.6b04f","ed7be37b.6435b","b56a84de.122758"],"x":255,"y":140,"wires":[["36800e0b.767d42"]]},{"id":"e55524c4.3c0e28","type":"debug","z":"ba7c0abf.cd20f8","name":"","active":false,"console":"false","complete":"false","x":950,"y":180,"wires":[]},{"id":"36800e0b.767d42","type":"function","z":"ba7c0abf.cd20f8","name":"Set Voice Control","func":"//var voice_message_reject = context.get('voice')||0; // initialise the voice to 1 if it doesn't exist already\nvar voice_message_reject = 0;\nvar newMsg = {};\nvar msgdata = msg.payload.split(\":\");\nnewMsg = msg.payload;\nvoice_message_reject = 0;\nvar voice_control = context.get('control')||0; // initialise the counter to 1 if it doesn't exist already\n\nvar datalength = msgdata.length;\n\nfor (i = 0; i < msgdata.length; i++) // look for the word ACZONES\n    { \n    if (msgdata[i] == \"ACZONES\")\n        {\n        voice_message_reject = 1;\n        var voice_message = \"reject on for AC Zones\";\n        //node.send ({payload:voice_message});\n        }\n    }\nfor (i = 0; i < msgdata.length; i++) // look for the word TEMPS\n    { \n    if (msgdata[i] == \"TEMPS\")\n        {\n        voice_message_reject = 1;\n        var voice_message = \"reject on for TEMPS\";\n        //node.send ({payload:voice_message});\n        }\n    }\n\n//for (i = 0; i < msgdata.length; i++) // look for the word Voice Control On\n//    { \n//    if (msgdata[i] == \"voice control on\")\n//        {\n//        voice_control = 1;\n//        //context.set('voice',voice_message_reject);\n//        var voice_message = \"voice control on\";\n//        node.send ({payload:voice_message});\n//        }\n//    }\n//for (i = 0; i < msgdata.length; i++) // look for the word Voice Control Off\n//    { \n//    if (msgdata[i] == \"voice control off\")\n//        {\n//        voice_control = 0;\n//        //context.set('voice',voice_message_reject);\n//        var voice_message = \"voice control off\";\n//        node.send ({payload:voice_message});\n//        }\n//    }\n\nif (newMsg ==\"voice control on\")\n    {\n    voice_control = 1;    \n    }\nif (newMsg ==\"voice control off\")\n    {\n    voice_control = 0;\n    }\n// store the value back\ncontext.set('control',voice_control);\n\nif (voice_control)\n    {\n    if (!voice_message_reject)\n        {\n        // make it part of the outgoing msg object\n        node.send ({payload:voice_control});\n        node.send ({payload:voice_message});\n        node.send ({payload:msg.payload});\n        }\n    }\n\nreturn null;","outputs":1,"noerr":0,"x":710,"y":140,"wires":[["d9809a91.ecae98","e55524c4.3c0e28"]]},{"id":"98c33f88.45866","type":"ui_button","z":"ba7c0abf.cd20f8","name":"Voice Control On","group":"dc7b8dc2.34836","order":0,"width":"3","height":"1","passthru":true,"label":"Voice On","color":"","bgcolor":"","icon":"","payload":"voice control on","payloadType":"str","topic":"","x":410,"y":80,"wires":[["36800e0b.767d42","d00afb80.5d9078"]]},{"id":"ac541da4.3461c","type":"ui_button","z":"ba7c0abf.cd20f8","name":"Voice Control Off","group":"dc7b8dc2.34836","order":0,"width":"3","height":"1","passthru":true,"label":"Voice Off","color":"","bgcolor":"","icon":"","payload":"voice control off","payloadType":"str","topic":"","x":410,"y":200,"wires":[["36800e0b.767d42","d00afb80.5d9078","7a28d9ea.83eda8"]]},{"id":"3ac81760.6a5cc8","type":"inject","z":"ba7c0abf.cd20f8","name":"Voice Control On","topic":"","payload":"voice control on","payloadType":"str","repeat":"","crontab":"","once":false,"x":200,"y":80,"wires":[["98c33f88.45866"]]},{"id":"a6d84278.643e4","type":"inject","z":"ba7c0abf.cd20f8","name":"Voice Control Off","topic":"","payload":"voice control off","payloadType":"str","repeat":"","crontab":"","once":false,"x":200,"y":200,"wires":[["ac541da4.3461c"]]},{"id":"d00afb80.5d9078","type":"debug","z":"ba7c0abf.cd20f8","name":"","active":false,"console":"false","complete":"false","x":650,"y":80,"wires":[]},{"id":"7a28d9ea.83eda8","type":"debug","z":"ba7c0abf.cd20f8","name":"","active":false,"console":"false","complete":"false","x":650,"y":220,"wires":[]},{"id":"dc7b8dc2.34836","type":"ui_group","z":"","name":"Voice Activation","tab":"102a2c35.d43174","disp":true,"width":"3"},{"id":"102a2c35.d43174","type":"ui_tab","z":"","name":"System Controls","icon":"dashboard","order":19}]